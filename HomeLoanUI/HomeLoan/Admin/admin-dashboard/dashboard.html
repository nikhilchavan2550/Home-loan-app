<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Google Fonts: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-gradient-to-br from-[#e8f0e3] to-[#d8edea] text-[#2f2f2f]">
    <!-- Sidebar Toggle Button -->
    <button id="sidebarToggle" class="btn btn-success m-3 d-md-none">
        <i class="fas fa-bars"></i> Menu
    </button>
    <div class="d-flex">
        <!-- Sidebar -->
        <div id="sidebar" class="bg-[#3a5a40] text-white shadow-lg min-vh-100 p-3">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="text-2xl font-bold text-[#fefae0]">Admin Panel</h2>
                <button id="collapseToggle" class="btn btn-sm btn-outline-light">
                    <i class="fas fa-chevron-left"></i>
                </button>
            </div>
            <ul class="nav flex-column gap-2">
                <li>
                    <a href="dashboard.html" class="flex items-center gap-3 p-3 rounded-lg hover:bg-[#588157] transition">
                        <i class="fas fa-home"></i>
                        <span class="nav-link-text">Dashboard</span>
                    </a>
                </li>
                <li>
                    <a href="application.html" class="flex items-center gap-3 p-3 rounded-lg hover:bg-[#588157] transition">
                        <i class="fas fa-list"></i>
                        <span class="nav-link-text">View All Applications</span>
                    </a>
                </li>
                <!-- <li>
                    <a href="income.html" class="flex items-center gap-3 p-3 rounded-lg hover:bg-[#588157] transition">
                        <i class="fas fa-wallet"></i>
                        <span class="nav-link-text">View Pending applications</span>
                    </a>
                </li> -->
                <li>
                    <a href="checkapplication.html" class="flex items-center gap-3 p-3 rounded-lg hover:bg-[#588157] transition">
                        <i class="fas fa-file"></i>
                        <span class="nav-link-text">Check application</span>
                    </a>
                </li>
                <!-- <li>
                    <a href="properties.html" class="flex items-center gap-3 p-3 rounded-lg hover:bg-[#588157] transition">
                        <i class="fas fa-building"></i>
                        <span class="nav-link-text">View Property Details</span>
                    </a>
                </li> -->
            </ul>
        </div>
        <!-- Main Content -->
        <div id="mainContent" class="flex-grow p-4 main-content">
            <!-- Top Bar -->
            <div class="d-flex justify-content-between align-items-center mb-4 fade-in">
                <h2 class="font-extrabold text-3xl md:text-xl text-[#3a5a40] mb-4">
                    Welcome, <span class="admin-name text-red-600 drop-shadow-lg">Admin</span>
                </h2>
                <div class="d-flex align-items-center gap-3">
                    <img src="img/admin.jpg" alt="Admin" class="rounded-circle" width="40">
                    <button id="logoutBtn" class="btn btn-sm btn-outline-danger">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
            <!-- Stats Cards -->
            <div class="row g-3 mb-4">
                <div class="col-md-3">
                    <div class="bg-white p-6 rounded-2xl shadow-md border border-[#cad2c5] card-hover pulse">
                        <h5 class="text-lg font-semibold text-[#3a5a40]">Total Applications</h5>
                        <h2 id="totalApplications" class="text-3xl font-bold text-[#588157]">0</h2>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="bg-white p-6 rounded-2xl shadow-md border border-[#cad2c5] card-hover">
                        <h5 class="text-lg font-semibold text-[#3a5a40]">Pending Applications</h5>
                        <h2 id="pendingApplications" class="text-3xl font-bold text-[#facc15]">0</h2>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="bg-white p-6 rounded-2xl shadow-md border border-[#cad2c5] card-hover">
                        <h5 class="text-lg font-semibold text-[#3a5a40]">Approved Applications</h5>
                        <h2 id="approvedApplications" class="text-3xl font-bold text-[#22c55e]">0</h2>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="bg-white p-6 rounded-2xl shadow-md border border-[#cad2c5] card-hover">
                        <h5 class="text-lg font-semibold text-[#3a5a40]">Rejected Applications</h5>
                        <h2 id="rejectedApplications" class="text-3xl font-bold text-[#ef4444]">0</h2>
                    </div>
                </div>
            </div>
            <!-- Charts -->
            <div class="row g-3 mb-4 fade-in">
                <div class="col-md-6">
                    <div class="bg-white p-3 rounded-lg shadow border border-[#cad2c5] card-hover">
                        <div class="chart-container">
                            <canvas id="statusChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="bg-white p-3 rounded-lg shadow border border-[#cad2c5] card-hover">
                        <div class="chart-container">
                            <canvas id="applicationsChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Recent Applications -->
            <div class="bg-white p-3 rounded-lg shadow border border-[#cad2c5] fade-in">
                <h5 class="font-bold text-[#3a5a40] mb-3">Recent Applications</h5>
                <table class="table table-hover">
                    <thead class="bg-[#588157] text-white">
                        <tr>
                            <th>ApplicationNumber</th>
                            <th>Applicant</th>
                            <th>Status</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody id="recentApplications">
                        <!-- Dynamic Rows -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="applicationModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content p-3">
                <h5 class="fw-bold mb-3" id="modalApplicantName"></h5>
                <p><strong>ID:</strong> <span id="modalAppId"></span></p>
                <p><strong>Status:</strong> <span id="modalStatus"></span></p>
                <p><strong>Date:</strong> <span id="modalDate"></span></p>
                <p><strong>Documents:</strong> <span id="modalDocs"></span></p>
                <p><strong>Property:</strong> <span id="modalProperty"></span></p>
                <div class="text-end">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script src="js/dashboard.js"></script>
    <script type="module">
        import { fetchCurrentAdmin } from './js/apicalls/adminapi.js';
        window.addEventListener('DOMContentLoaded', async () => {
            const adminNameSpan = document.querySelector('.admin-name');
            try {
                const admin = await fetchCurrentAdmin();
                if (adminNameSpan && admin.adminName) {
                    adminNameSpan.textContent = admin.adminName;
                }
            } catch (e) {
                // fallback, do nothing
            }
        });
    </script>
    <script>
        // Enhanced Sidebar toggle with animation
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('mainContent');
        const toggleBtn = document.getElementById('sidebarToggle');
        const collapseBtn = document.getElementById('collapseToggle');
        // Toggle sidebar (mobile)
        toggleBtn.addEventListener('click', () => {
            sidebar.classList.toggle('hidden');
            if (sidebar.classList.contains('hidden')) {
                mainContent.style.marginLeft = '50px';
            } else {
                mainContent.style.marginLeft = '50px';
            }
        });
        // Collapse sidebar (desktop)
        collapseBtn.addEventListener('click', () => {
            sidebar.classList.toggle('collapsed');
            if (sidebar.classList.contains('collapsed')) {
                collapseBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
                mainContent.style.marginLeft = '80px';
            } else {
                collapseBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
                mainContent.style.marginLeft = '50px';
            }
        });
        // Check initial screen size
        function checkScreenSize() {
            if (window.innerWidth < 768) {
                sidebar.classList.add('hidden');
                mainContent.style.marginLeft = '0';
            } else {
                sidebar.classList.remove('hidden');
                mainContent.style.marginLeft = '50px';
            }
        }
        // Handle window resize
        window.addEventListener('resize', checkScreenSize);
        
        // Initialize on load
        window.addEventListener('load', checkScreenSize);
        // Logout button functionality
        document.getElementById('logoutBtn').addEventListener('click', async () => {
            try {
                const response = await fetch('http://localhost:8083/admin/logout', {  // need to change this URL to your actual logout endpoint
                    method: 'POST',
                    credentials: 'include'
                });
                if (response.ok) {
                    // Redirect to login page or show a message
                    window.location.href = '../../admin_login.html';
                } else {
                    alert('Logout failed');
                    window.location.href = '../../admin_login.html';

                }
            } catch (error) {
                alert('Logout error');
            }
        });
    </script>
</body>
</html>
